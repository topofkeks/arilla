#include "peripheral.h"

#define STACK_SIZE 608

const unsigned int ICON_ARILLA =256;
const unsigned int ICON_PEN =384;
const unsigned int ICON_LINE =416;
const unsigned int ICON_RECT =448;
const unsigned int ICON_FILL_RECT =480;
const unsigned int ICON_BUCKET =512;
const unsigned int ICON_CLEAR =544;
const unsigned int ICON_ETF =576;

unsigned int stack[STACK_SIZE]=
{
0b00000000000000000000000000000000,0b00000000000000000000000000000000,0b00000000000000000000000000001111,0b11111100000000000000000000000000,
0b00000000000000000000001111111111,0b11100000000000000000000000000000,0b00000000000000000000000001111111,0b11111111100000000000000000000000,
0b00000000000000000000111111111111,0b11111100000000000000000000000000,0b00000000000000000000000011111111,0b11111111110000000000000000000000,
0b00000000000000000111111111111111,0b11111111000000000000000000000000,0b00000000000000000000001111111111,0b11111111111100000000000000000000,
0b00000000000000011111111111111111,0b11111111100000000000000000000000,0b00000000000000000000011111111111,0b11111111111110000000000000000000,
0b00000000000001111111111111111011,0b01100001110000000000000000000000,0b00000000000000000000111111111111,0b11111111111111000000000000000000,
0b00000000000001111111111111111101,0b11010100011000000000000000000000,0b00000000000000000001111111111111,0b11111111111111110000000000000000,
0b00000000000001111111111111101011,0b10101000000100000000000000000000,0b00000000000000000011111111111111,0b11111111111111111000000000000000,
0b00000000000011111111111101111101,0b01010010100110000000000000000000,0b00000000000000000111111111111111,0b11111111111111111100000000000000,
0b00000000000111111111101111101101,0b01010000010011000000000000000000,0b00000000000000001111111111111111,0b11111111111111111110000000000000,
0b00000000001111111111111011111010,0b10100101000001100000000000000000,0b00000000000000011111111111111111,0b11111111111111111111000000000000,
0b00000000011111111111011111010101,0b01001000010100110000000000000000,0b00000000000000010111111111111111,0b11111111111111111111110000000000,
0b00000000111111101010110101101100,0b10100010100000010000000000000000,0b00000000000000101111111111111111,0b11111111111111111111110000000000,
0b00000001111111111111010110100101,0b00010000010101011000000000000000,0b00000000000000101111111111111111,0b11111111111111111111111000000000,
0b00000001111111110100101001011010,0b01000101000000001000000000000000,0b00000000000001011111111111111111,0b11111111111111111111111100000000,
0b00000011111111111101001010100000,0b10001000001010101100000000000000,0b00000000000000111111111111111111,0b11111111111111111111111100000000,
0b00000111111111110010100100001010,0b00100010100000001100000000000000,0b00000000000011111111111111111111,0b11111111111111111111111110000000,
0b00000111111111111001010010100001,0b00010000010101000110000000000000,0b00000000000000111111111111111111,0b11111111111111111111111110000000,
0b00000111111111110110001000010100,0b01000101000000010010000000000000,0b00000000000011111111111111111111,0b11111111111111111111111111000000,
0b00000111111111101001010101000000,0b10001000001010100110000000000000,0b00000000000001111111111111111111,0b11111111111111111111111111000000,
0b00001111111111110100100010010101,0b00100010100000001010000000000000,0b00000000000111111111111111100000,0b01111111111111111111111110000000,
0b00001111111111101010011001000000,0b10010000010101000110000000000000,0b00000000000011111111111110000000,0b00101111111111111111111110000000,
0b00001111111111110101100010101010,0b01000101000000101110000000000000,0b00000000000111111111111100000101,0b00011011111111111111111110000000,
0b00001111111111101010001101000000,0b10001000010101011100000000000000,0b00000000000111111111111000010000,0b00100101011111111111111110000000,
0b00001111111111110101100010010101,0b00100010100010111010000000000000,0b00000000001111111111110000000000,0b10001001010101111111111110000000,
0b00001111111111111010011001001000,0b10010000010101110100000000000000,0b00000000001111111111100000000000,0b01000100101010111111111110000000,
0b00001111111111111101100010100010,0b01000101001010101010000000000000,0b00000000000111111111000010000000,0b00010001010101011111111110000000,
0b00001111111111110101001101010100,0b10010010010101010111000000000000,0b00000000001111111111001000010000,0b00100010001010110011111100000000,
0b00001111111111111110110010001001,0b00000101101010100110000000000000,0b00000000001111111110000010101100,0b10001001010101101111111000000000,
0b00001111111111111011011010100100,0b10101111110101100010100000000000,0b00000000001111111100010000010110,0b01000100100100110111111000000000,
0b00011111111111111101110100101010,0b01011110001010011110000000000000,0b00000000000111111110000101001001,0b10110001011011011011111000000000,
0b00011111111111111111101101010100,0b11111001111000101001010000000000,0b00000000001111111100000010000011,0b01000010111111110111111000000000,
0b00011111111111111111110010101011,0b11100111000101001010000000000000,0b00000000001001111000000001111110,0b10000101110101011111110000000000,
0b00011111111111111111011001010101,0b01010111101010100101010000000000,0b00000000001000111100000000011111,0b10000011100010101011110000000000,
0b00011111111111111111100110101011,0b10110110101010010010100000000000,0b00000000000100111000000000000010,0b10000001111111110111110000000000,
0b00011111111111111111011001010110,0b01100001010010100100010000000000,0b00000000000101000000000000100101,0b00000111111111111011110000000000,
0b00011111111111111111100110101001,0b11001111001001001001000000000000,0b00000000000100000000000000001000,0b00010011110111101111100000000000,
0b00011111111111111111110001010100,0b00110100100101010100100000000000,0b00000000000110000000000000100000,0b00000101111001110111110000000000,
0b00011111111111111111111110101010,0b10001010010010100010010000000000,0b00000000000110001000000000001010,0b00000011011110001011100000000000,
0b00011111111111111111111001010000,0b00010000100101010100100000000000,0b00000000000010010000000000010000,0b01000010111010110111100000000000,
0b00001111111111111111110100101010,0b10000101001010100001010000000000,0b00000000000010001000000000000101,0b00001011101101001111000000000000,
0b00001111111111111111111110010100,0b00101010100101011000101000000000,0b00000000000011000000000000101010,0b00000101110110100110000000000000,
0b00000111111101101100111101101010,0b10000100001010010110101000000000,0b00000000000001010100000000001010,0b00000010111101010110000000000000,
0b00000111111101000001110101010101,0b00101001010101111011011000000000,0b00000000000001000000000010110000,0b11100101110101010100000000000000,
0b00000111111100010110011110101010,0b10100100100010010111111000000000,0b00000000000010010100000001000001,0b00011111111101010100000000000000,
0b00000111111110101010101010100101,0b01010010010101101110111000000000,0b00000000001110000000000101101000,0b10101111111110101100000000000000,
0b00000111111111001001001101011010,0b10010100100010011011001100000000,0b00000000011111010000000010110111,0b10100111011101010100000000000000,
0b00001111111111010010011011010101,0b00100101001010110100111100000000,0b00000000011110010100000011101000,0b00101111111010101100000000000000,
0b00000101111111110100101110110101,0b01010100101011010111001000000000,0b00000000111110100000100100010111,0b01001011111101011000000000000000,
0b00000111111111111100010111011010,0b10101010010101101010101100000000,0b00000000111110011010000000000001,0b11110110111110101000000000000000,
0b00000001111111111111111101110111,0b01010010101111010101010100000000,0b00000000111111010101010000000000,0b00011111111101011000000000000000,
0b00000011111111111001001011101110,0b11010101011010101010111100000000,0b00000000111110001010000001000000,0b10100111111101110000000000000000,
0b00100101111111010010011011011011,0b01101010110101010111101000000000,0b00000001111111011101101000000010,0b01011101110111110000000000000000,
0b00000000111111101001011101110101,0b10110101011010101111101100000000,0b00000001111111001110100100000001,0b01000110110101110000000000000000,
0b00000000111100010010011010111111,0b01101101010101011011010100000000,0b00000001111111100111010001000000,0b10111011011111100000000000000000,
0b00000000101001100100011111101110,0b11011011110101010110101100100000,0b00000001111111100111110110000000,0b00000110111011100000000000000000,
0b00100010000000000001011001011101,0b10110110101110101001111100000000,0b00000011111111110011101001010000,0b10010101101111000000000000000000,
0b00000000001010100100011110110111,0b11011011010101010101011000000000,0b00000011111111110011110111100000,0b10011110111110000000000000000000,
0b00010000000000000001001111011111,0b01101101111110111011111100100100,0b00000111111111111001111101111101,0b10101011111110000000000000000000,
0b00000001000100010010000110110110,0b11111011011101010111111000000000,0b00001111111111111100111111111011,0b01011111111110000000000000000000,
0b00010000000010100000101111011101,0b10111111110110111101110000000000,0b00011111111111111100011110111111,0b11111111111111000000000000000000,
0b01001000000010000000000011101010,0b11111111111111111111100001000000,0b01111111111111111101000111111111,0b11111111111111100000000000000000,
0b00000100010001001001010001011111,0b01010111111111111110000000000000,0b11111111111111111100101001111111,0b11111101111111100000000000000000,
0b00000000000000000000000001110010,0b11010101011111110000000000000000,0b11111111111111111110100010111011,0b11111101111111110000000000000000,
0b00000000000000000000000000000000,0b00000000000000000101010101010101,0b01010101010101010000000000000000,0b00000000000000000000000000000000,
0b00000000000000000000000000000000,0b00000001010101010101010101010101,0b01010101010101010101010101000000,0b00000000000000000000000000000000,
0b00000000000000000000000000000001,0b01010101010101010101010101010101,0b01010101010101010101010101010101,0b01000000000000000000000000000000,
0b00000000000000000000000001010101,0b01010101010101010101010101010101,0b01010101010101010101010101010101,0b01010101000000000000000000000000,
0b00000000000000000000010101010101,0b01010101010101010101010101010101,0b01010101010101010101010101010101,0b01010101010100000000000000000000,
0b00000000000000000101010101010101,0b01010101010101010110101010101010,0b10101010101010101010100101010101,0b01010101010101010000000000000000,
0b00000000000001010101010101010101,0b01010110101010101010101010101010,0b10101010101010101010101010101010,0b10010101010101010101000000000000,
0b00000000000101010101010101010110,0b10101010101010101010101010101111,0b11111111111111111111111111111010,0b10101010100101010101010000000000,
0b00000000010101010101010110101010,0b10101010101010101011111111111111,0b11111111111111111111111111111111,0b11111110101010100101010100000000,
0b00000001010101010101101010101010,0b10101010101111111111111111111111,0b11111111111111111111111110101111,0b11101111111111101010010101000000,
0b00000101010101011010101010101010,0b10101011111111111111111111111111,0b11111111111111111010111110101111,0b10101011111111111110101001010000,
0b00010101010101101010101010101010,0b10111111111111111111111111111111,0b11111111111111111010111010101111,0b10101111111111111111111010010100,
0b00010101010110101010101010101011,0b11111111111111111111111111111111,0b11111111111111111111111010101111,0b10101111111111111111111111100100,
0b01010101011010101010101010101111,0b11111111111111111010101011111110,0b10111010101111101011111010101111,0b10101111111010101011111111111001,
0b01010101101010101010101010101111,0b11111111111111101010101010111110,0b10101010101011101011111010111110,0b10101111101010101010111111111010,
0b01010101101010101010101010111111,0b11111111111110101011101010111110,0b10101110101011101011111010111110,0b10101110101011111010111111111110,
0b01010101101010101010101010111111,0b11111111111010101111101011111010,0b10111110101110101011111010111110,0b10101010101111101010111111111110,
0b01010101101010101010101010111111,0b11111111111010111111101011111010,0b10111111111110101011101010111110,0b10111010111111101010111111111110,
0b01010101101010101010101010101111,0b11111111111010111111101011111010,0b11111111111110101111101010111110,0b10111010111111101011111111111010,
0b00010101011010101010101010101111,0b11111111111010101010101011111010,0b11111111111110101111101010111110,0b10111010101010101010111111111000,
0b00010101010110101010101010101011,0b11111111111010101010101010111010,0b11111111111110101111101011111110,0b10111110101010101010111111100100,
0b00000101010101101010101010101010,0b10111111111111111111111111111111,0b11111111111111111111111111111111,0b11111111111111111111111010010000,
0b00000001010101011010101010101010,0b10101011111111111111111111111111,0b11111111111111111111111111111111,0b11111111111111111110101001000000,
0b00000000010101010101101010101010,0b10101010101111111111111111111111,0b11111111111111111111111111111111,0b11111111111111101010010100000000,
0b00000000000101010101010110101010,0b10101010101010101011111111111111,0b11111111111111111111111111111111,0b11111110101010100101010000000000,
0b00000000000001010101010101010110,0b10101010101010101010101010101111,0b11111111111111111111111111111010,0b10101010100101010101000000000000,
0b00000000000000000101010101010101,0b01010110101010101010101010101010,0b10101010101010101010101010101010,0b10010101010101010000000000000000,
0b00000000000000000000010101010101,0b01010101010101010110101010101010,0b10101010101010101010100101010101,0b01010101010100000000000000000000,
0b00000000000000000000000001010101,0b01010101010101010101010101010101,0b01010101010101010101010101010101,0b01010101000000000000000000000000,
0b00000000000000000000000000000001,0b01010101010101010101010101010101,0b01010101010101010101010101010101,0b01000000000000000000000000000000,
0b00000000000000000000000000000000,0b00000001010101010101010101010101,0b01010101010101010101010101000000,0b00000000000000000000000000000000,
0b00000000000000000000000000000000,0b00000000000000000101010101010101,0b01010101010101010000000000000000,0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111011111110,
0b01111111111111111111110101111110,
0b01111111111111111111101110111110,
0b01111111111111111111010111011110,
0b01111111111111111110111010111110,
0b01111111111111111101111101111110,
0b01111111111111111011111011111110,
0b01111111111111110111110111111110,
0b01111111111111101111101111111110,
0b01111111111111011111011111111110,
0b01111111111110111110111111111110,
0b01111111111101111101111111111110,
0b01111111111011111011111111111110,
0b01111111110111110111111111111110,
0b01111111101111101111111111111110,
0b01111111011111011111111111111110,
0b01111110101110111111111111111110,
0b01111101110101111111111111111110,
0b01111100111011111111111111111110,
0b01111100010111111111111111111110,
0b01111100001111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01110011111111111111111111111110,
0b01110001111111111111111111111110,
0b01111000111111111111111111111110,
0b01111100011111111111111111111110,
0b01111110001111111111111111111110,
0b01111111000111111111111111111110,
0b01111111100011111111111111111110,
0b01111111110001111111111111111110,
0b01111111111000111111111111111110,
0b01111111111100011111111111111110,
0b01111111111110001111111111111110,
0b01111111111111000111111111111110,
0b01111111111111100011111111111110,
0b01111111111111110001111111111110,
0b01111111111111111000111111111110,
0b01111111111111111100011111111110,
0b01111111111111111110001111111110,
0b01111111111111111111000111111110,
0b01111111111111111111100011111110,
0b01111111111111111111110001111110,
0b01111111111111111111111000111110,
0b01111111111111111111111100011110,
0b01111111111111111111111110001110,
0b01111111111111111111111111001110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01110000000000000000000000001110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110111111111111111111111101110,
0b01110000000000000000000000001110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111001111111111111110,
0b01111111111111010111111111111110,
0b01111111111110110111111111111110,
0b01111111111110100111111111111110,
0b01111111111110010011111111111110,
0b01111111111110111011111111111110,
0b01111111111101111001111111111110,
0b01111111111000111010111111111110,
0b01111111110000011001011111111110,
0b01111111100000001001101111111110,
0b01111111000000000111110111111110,
0b01111110000000000011111011111110,
0b01111101000000000001110101111110,
0b01111011100000000000101000111110,
0b01111101110000000000010000011110,
0b01111110111000000000110000011110,
0b01111111011100000001110000011110,
0b01111111101110000011111000111110,
0b01111111110111000111111111111110,
0b01111111111011101111111111111110,
0b01111111111101011111111111111110,
0b01111111111110111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00000000000000000000000000000000,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01110000000000000000000000001110,
0b01110110110110110110110110101110,
0b01110011011011011011011011001110,
0b01110101101101101101101101101110,
0b01110110110110110110110110101110,
0b01110011011011011011011011001110,
0b01110101101101101101101101101110,
0b01110110110110110110110110101110,
0b01110011011011011011011011001110,
0b01110101101101101101101101101110,
0b01110110110110110110110110101110,
0b01110011011011011011011011001110,
0b01110101101101101101101101101110,
0b01110110110110110110110110101110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01110000000000000000000000001110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b01111111111111111111111111111110,
0b00000000000000000000000000000000,
0b00011111111111111111111111111000,
0b00011111111111111111111111111000,
0b00011100000000000000000000111000,
0b00011100000000000000000000111000,
0b00011100000000000000000000111000,
0b00011100001111111111110000111000,
0b00011100001111111111110000111000,
0b00011100000000011000000000000000,
0b00011100000000111100000000000000,
0b00011100000111111111000000000000,
0b00011100001111111111110000011000,
0b00011100011110011001111000111000,
0b00011100011100011000111000111000,
0b00011100111000011000011100111000,
0b00011100111000011000011100111000,
0b00011111111111111111111111111000,
0b00011111111111111111111111111000,
0b00011100111000011000011100111000,
0b00011100111000011000011100111000,
0b00011100011100011000111000111000,
0b00011100011110011001111000111000,
0b00011100001111111111110000011000,
0b00011100000111111111100000000000,
0b00011100000001111110000000000000,
0b00011100000000011000000000000000,
0b00011100001111111111110000111000,
0b00011100001111111111110000111000,
0b00011100000000000000000000111000,
0b00011100000000000000000000111000,
0b00011100000000000000000000111000,
0b00011111111111111111111111111000,
0b00011111111111111111111111111000
};

unsigned int sp=0;

void pop(point* p)
{
    p->x=stack[--sp]&MOUSE_POSITION_MASK;
    p->y=stack[sp]>>10;
}

void push(unsigned int x,unsigned int y)
{
    if(sp!=STACK_SIZE)
    {
        stack[sp++]=(y<<10)|(x&MOUSE_POSITION_MASK);
    }
}

void drawIconOpt(unsigned int x,unsigned int y,unsigned int col,const unsigned int icon,unsigned int bgVal)
{
    for(int i=0;i<32;i++)
    {
        unsigned int row=stack[icon+i];
        for(int j=31;j>=0;j--)
        {
            if(row%2!=bgVal)
            {
                gpuDrawPoint_c(x+j,y+i,col);
            }
            row>>=1;
        }
    }
}

void EE()
{
    for(int i=0;i<64;i++)
    {
        for(int k=0;k<4;k++)
        {
            unsigned int row=stack[(i*4)+k];
            for(int j=31;j>=0;j--)
            {
                if(row%2)
                {
                    gpuDrawPoint_c((k*32)+j,i,0x000);
                }
                row>>=1;
            }
        }
    }
}

void AL(unsigned int x,unsigned int y,unsigned int scale,unsigned int scale2)
{
    for(int i=0;i<32;i++)
    {
        for(int k=0;k<4;k++)
        {
            unsigned int row=stack[ICON_ARILLA+(i*4)+k];
            for(int j=15;j>=0;j--)
            {
                switch(row%4)
                {
                    case 1:{gpuFillRect_c((x+((k*16)<<scale))+(j<<scale),y+(i<<scale),x+(scale2-1)+((k*16)<<scale)+(j<<scale),y+(scale2-1)+(i<<scale),0x024);break;}
                    case 2:{gpuFillRect_c((x+((k*16)<<scale))+(j<<scale),y+(i<<scale),x+(scale2-1)+((k*16)<<scale)+(j<<scale),y+(scale2-1)+(i<<scale),0xFFF);break;}
                    case 3:{gpuFillRect_c((x+((k*16)<<scale))+(j<<scale),y+(i<<scale),x+(scale2-1)+((k*16)<<scale)+(j<<scale),y+(scale2-1)+(i<<scale),0xF11);break;}
                    default:{break;}
                }
                row>>=2;
            }
        }
    }
}

void floodFill(unsigned int x,unsigned int y,unsigned int dst)
{
    unsigned int src=gpuGetColor(x,y);
    if(src==dst){return;}
    push(x,y);

    point p;
    unsigned int set;
    unsigned int minx;
    unsigned int maxx;

    while (sp != 0)
    {
        pop(&p);
        if (gpuGetColor(p.x, p.y) == src)
        {
            set=0;
            minx = p.x - 1;
            maxx = p.x + 1;

            while (minx < 800 && gpuGetColor(minx, p.y) == src)
            {
                minx--;
            }
            minx++;
            while (maxx < 800 && gpuGetColor(maxx, p.y) == src)
            {
                maxx++;
            }
            maxx--;

            p.y--;
            if ((p.y) < 600 - 64)
            {
                for(unsigned int i=minx;i<=maxx;i++)
                {
                    if (gpuGetColor(i, p.y) == src)
                    {
                        if (!set)
                        {
                            push(i, p.y);
                            set = 1;
                        }
                    }
                    else
                    {
                        set = 0;
                    }
                }
            }

            set=0;
            p.y+=2;
            if ((p.y) < 600 - 64)
            {
                for(unsigned int i=minx;i<=maxx;i++)
                {
                    if (gpuGetColor(i, p.y) == src)
                    {
                        if (!set)
                        {
                            push(i, p.y);
                            set = 1;
                        }
                    }
                    else
                    {
                        set = 0;
                    }
                }
            }
            p.y--;

            if (minx == maxx)
            {
                gpuDrawPoint(minx, p.y);
            }
            else
            {
                gpuDrawLine(minx, p.y, maxx, p.y);
            }
        }
    }
}
